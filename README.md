# Ethernet + mDNS ν…μ¤νΈ ν”„λ΅μ νΈ

## π― ν”„λ΅μ νΈ λ©μ 

ESP32-S3μ—μ„ W5500 Ethernet μ‚¬μ© μ‹ mDNSκ°€ μ‘λ™ν•λ”μ§€ λ‹¤μ–‘ν• λ°©λ²•μΌλ΅ ν…μ¤νΈν•λ” ν”„λ΅μ νΈμ…λ‹λ‹¤.

## π§ ν…μ¤νΈ λ°©λ²•

μ΄ ν”„λ΅μ νΈλ” 3κ°€μ§€ λ‹¤λ¥Έ λ°©λ²•μΌλ΅ mDNSλ¥Ό ν…μ¤νΈν•©λ‹λ‹¤:

### ν…μ¤νΈ 1: Ethernetλ§ μ‚¬μ© (μμ)
- Ethernet μ΄κΈ°ν™”
- λ°”λ΅ mDNS μ‹μ‘
- `m5stack-eth.local`λ΅ ν…μ¤νΈ

### ν…μ¤νΈ 2: WiFi μ¤νƒ ν™μ„±ν™” ν›„
- Ethernet μ΄κΈ°ν™”
- WiFi μ¤νƒ ν™μ„±ν™” (μ—°κ²° μ—†μ΄)
- WiFi IPλ¥Ό Ethernet μ„λΈλ„·μΌλ΅ μ„¤μ •
- mDNS μ‹μ‘
- `m5stack-eth2.local`λ΅ ν…μ¤νΈ

### ν…μ¤νΈ 3: WiFi AP λ¨λ“ ν™μ©
- Ethernet λ¨Όμ € μ΄κΈ°ν™”
- WiFi AP λ¨λ“ μ‹μ‘
- mDNS μ‹μ‘
- `m5stack-eth3.local`λ΅ ν…μ¤νΈ

## π€ μ‚¬μ©λ²•

### 1. μ—…λ΅λ“ λ° μ‹¤ν–‰

```bash
cd ethernet-mdns-test
platformio run -t upload && platformio device monitor
```

### 2. ν…μ¤νΈ μ§„ν–‰

ν”„λ΅κ·Έλ¨μ΄ μλ™μΌλ΅ 3κ°€μ§€ ν…μ¤νΈλ¥Ό μμ°¨μ μΌλ΅ μ‹¤ν–‰ν•©λ‹λ‹¤. κ° ν…μ¤νΈλ§λ‹¤ 10μ΄κ°„ λ€κΈ°ν•λ©°, κ·Έ λ™μ• λ‹¤λ¥Έ PCμ—μ„ mDNS μ΄λ¦„ ν•΄μ„μ„ ν…μ¤νΈν•  μ μμµλ‹λ‹¤.

### 3. λ‹¤λ¥Έ PCμ—μ„ ν…μ¤νΈ

#### macOS / Linux
```bash
# κ° ν…μ¤νΈ μ¤‘μ— μ‹¤ν–‰
ping m5stack-eth.local
ping m5stack-eth2.local
ping m5stack-eth3.local

# μµμΆ… μ„¤μ • ν›„
ping m5stack.local
```

#### Windows
```powershell
ping m5stack-eth.local
ping m5stack-eth2.local
ping m5stack-eth3.local
ping m5stack.local
```

#### mDNS μ„λΉ„μ¤ κ²€μƒ‰
```bash
# macOS / Linux (avahi-browse λλ” dns-sd)
dns-sd -B _http._tcp

# λλ”
avahi-browse -a
```

## π“ μ‹¤μ  ν…μ¤νΈ κ²°κ³Ό (κ²€μ¦ μ™„λ£)

### β κ²°κ³Ό: λ¨λ“  ν…μ¤νΈ μ‹¤ν¨

**ν…μ¤νΈ ν™κ²½**: M5Stack CoreS3 + W5500 Base LAN PoE
**ν…μ¤νΈ μΌμ**: 2025λ…„ 11μ›”

```
β ν…μ¤νΈ 1 (Ethernetλ§): ping m5stack-eth.local β†’ Unknown host
β ν…μ¤νΈ 2 (WiFi μ¤νƒ): ping m5stack-eth2.local β†’ Unknown host  
β ν…μ¤νΈ 3 (WiFi AP): ping m5stack-eth3.local β†’ Unknown host
β μµμΆ… μ„¤μ •: ping m5stack.local β†’ Unknown host
```

### π” μƒμ„Έ λ¶„μ„

1. **mDNS μ΄κΈ°ν™”**: β… μ„±κ³µ (MDNS.begin() λ°ν™κ°’ true)
2. **Ethernet μ—°κ²°**: β… μ„±κ³µ (DHCPλ΅ IP ν• λ‹Ή)
3. **WiFi μ¤νƒ ν™μ„±ν™”**: β… μ„±κ³µ (WiFi AP λ¨λ“ μ‘λ™)
4. **mDNS μ΄λ¦„ ν•΄μ„**: β **μ‹¤ν¨** (λ¨λ“  λ°©λ²•μ—μ„)

### π“ ν™•μΈλ μ›μΈ

**ESP32μ mDNS κµ¬ν„μ΄ Ethernet μΈν„°νμ΄μ¤λ¥Ό μ§€μ›ν•μ§€ μ•μ**

- mDNS λΌμ΄λΈλ¬λ¦¬λ” WiFi μΈν„°νμ΄μ¤μ—λ§ λ°”μΈλ”©λ¨
- WiFi AP λ¨λ“λ¥Ό ν™μ„±ν™”ν•΄λ„ Ethernet μΈν„°νμ΄μ¤μ—μ„λ” μ‘λ™ μ• ν•¨
- mDNS μ΄κΈ°ν™”λ” μ„±κ³µν•μ§€λ§ μ‹¤μ  μ΄λ¦„ ν•΄μ„μ€ WiFi μΈν„°νμ΄μ¤μ—μ„λ§ κ°€λ¥

## π”¬ ν•λ“μ›¨μ–΄ μ„¤μ •

- **λ””λ°”μ΄μ¤**: M5Stack CoreS3 (ESP32-S3)
- **μ΄λ”λ„· λ¨λ“**: Base LAN PoE (W5500)
- **μ „μ›**: PoE λλ” μ™Έλ¶€ 5V

### ν•€ λ§µν•‘
```
MOSI: GPIO 37 (M-BUS)
MISO: GPIO 35 (M-BUS)
SCK:  GPIO 36 (M-BUS)
CS:   GPIO 9  (M-BUS)
RST:  GPIO 7  (M-BUS)
IRQ:  GPIO 4  (M-BUS)
```

## π“ ν…μ¤νΈ λ΅κ·Έ λ¶„μ„

μ‹λ¦¬μ–Ό λ¨λ‹ν„°μ—μ„ λ‹¤μ μ •λ³΄λ¥Ό ν™•μΈν•μ„Έμ”:

1. **κ° ν…μ¤νΈμ mDNS μ΄κΈ°ν™” μ„±κ³µ/μ‹¤ν¨**
2. **Ethernet IP μ£Όμ† ν• λ‹Ή**
3. **WiFi λ¨λ“ λ° μƒνƒ**
4. **mDNS μ—…λ°μ΄νΈ νΈμ¶ ν™•μΈ**

## π― μµμΆ… λ™μ‘

λ¨λ“  ν…μ¤νΈκ°€ λλ‚ ν›„, ν”„λ΅κ·Έλ¨μ€ **ν…μ¤νΈ 3 λ°©μ‹**(κ°€μ¥ κ°€λ¥μ„± λ†’μ€ λ°©λ²•)μΌλ΅ κ³„μ† λ™μ‘ν•©λ‹λ‹¤:

- Ethernet: DHCPλ΅ IP ν• λ‹Ή
- WiFi: AP λ¨λ“ (mDNS ν™μ„±ν™”μ©)
- mDNS: `m5stack.local`

5μ΄λ§λ‹¤ ν„μ¬ μƒνƒλ¥Ό μ‹λ¦¬μ–Ό λ¨λ‹ν„°μ— μ¶λ ¥ν•©λ‹λ‹¤.

## π’΅ κ¶μ¥ λ€μ• (κ²€μ¦λ λ°©λ²•)

### β… λ°©λ²• 1: IP μ£Όμ† μ§μ ‘ μ‚¬μ© (κ°€μ¥ μ•μ •μ )

mDNS μ—†μ΄ DHCPλ΅ ν• λ‹Ήλ IP μ£Όμ†λ¥Ό μ§μ ‘ μ‚¬μ©

```bash
# μ‹λ¦¬μ–Ό λ¨λ‹ν„°μ—μ„ IP ν™•μΈ ν›„
curl http://10.10.10.37/api/status
```

**μ¥μ **:
- μ¦‰μ‹ μ‚¬μ© κ°€λ¥
- μ¶”κ°€ μ„¤μ • λ¶ν•„μ”
- 100% μ•μ •μ 

**λ‹¨μ **:
- IP μ£Όμ†λ¥Ό κΈ°μ–µν•΄μ•Ό ν•¨
- DHCPλ΅ IPκ°€ λ³€κ²½λ  μ μμ

### β… λ°©λ²• 2: DHCP μμ•½ (κ¶μ¥)

λΌμ°ν„°μ—μ„ MAC μ£Όμ† κΈ°λ°μΌλ΅ κ³ μ • IP ν• λ‹Ή

**μ„¤μ • λ°©λ²•**:
1. λΌμ°ν„° κ΄€λ¦¬ νμ΄μ§€ μ ‘μ†
2. DHCP μ„λ²„ μ„¤μ • β†’ DHCP μμ•½
3. M5Stackμ MAC μ£Όμ† λ“±λ΅ (μ‹λ¦¬μ–Ό λ¨λ‹ν„°μ—μ„ ν™•μΈ)
4. μ›ν•λ” IP μ£Όμ† ν• λ‹Ή (μ: 10.10.10.100)

**μ¥μ **:
- ν•­μƒ κ°™μ€ IP μ£Όμ†
- DNS μ„¤μ • λ¶ν•„μ”
- κ΄€λ¦¬κ°€ μ‰¬μ›€

### β… λ°©λ²• 3: λ΅μ»¬ DNS μ„λ²„ (κ³ κΈ‰)

Pi-hole, dnsmasq, Unbound λ“±μ„ μ‚¬μ©ν•μ—¬ λ΅μ»¬ DNS κµ¬μ¶•

**μμ‹ (dnsmasq)**:
```bash
# /etc/dnsmasq.conf λλ” /etc/hosts
10.10.10.37  m5stack.local
```

**μ¥μ **:
- mDNSμ™€ μ μ‚¬ν• μ‚¬μ© κ²½ν—
- μ—¬λ¬ λ””λ°”μ΄μ¤ κ΄€λ¦¬ κ°€λ¥

**λ‹¨μ **:
- μ¶”κ°€ μ„λ²„ ν•„μ”
- μ„¤μ •μ΄ λ³µμ΅

### β οΈ λ°©λ²• 4: WiFi + Ethernet λ™μ‹ μ‚¬μ© (λΉ„κ¶μ¥)

WiFiλ” mDNSμ©, Ethernetμ€ λ°μ΄ν„° ν†µμ‹ μ©

**λ¬Έμ μ **:
- λ³µμ΅ν• λΌμ°ν… μ„¤μ • ν•„μ”
- μ „λ ¥ μ†λΉ„ μ¦κ°€
- μ•μ •μ„± μ €ν• κ°€λ¥

## π“ μ°Έκ³  μλ£

- [ESP32 mDNS λΌμ΄λΈλ¬λ¦¬](https://github.com/espressif/arduino-esp32/tree/master/libraries/ESPmDNS)
- [Ethernet_Generic λΌμ΄λΈλ¬λ¦¬](https://github.com/khoih-prog/Ethernet_Generic)
- [ESP32 ν¬λΌ - Ethernet mDNS μ΄μ](https://esp32.com/viewtopic.php?t=7941)

## π μµμΆ… κ²°λ΅ 

### β mDNS μ‚¬μ© λ¶κ°€ (κ²€μ¦ μ™„λ£)

**ESP32-S3 + W5500 ν™κ²½μ—μ„ mDNSλ” μ‘λ™ν•μ§€ μ•μµλ‹λ‹¤.**

μ΄ ν…μ¤νΈ ν”„λ΅μ νΈλ¥Ό ν†µν•΄ λ‹¤μμ΄ ν™•μΈλμ—μµλ‹λ‹¤:
1. β… Ethernet μ—°κ²° λ° ν†µμ‹ : μ •μƒ
2. β… mDNS λΌμ΄λΈλ¬λ¦¬ μ΄κΈ°ν™”: μ„±κ³µ
3. β mDNS μ΄λ¦„ ν•΄μ„: **μ‹¤ν¨** (λ¨λ“  λ°©λ²• μ‹λ„)
4. β WiFi μ¤νƒ ν™μ„±ν™”: mDNSμ— μν–¥ μ—†μ

### π“ κ¶μ¥ λ°©λ²•

**DHCP μμ•½ + IP μ£Όμ† μ§μ ‘ μ‚¬μ©**μ΄ κ°€μ¥ μ‹¤μ©μ μΈ ν•΄κ²°μ±…μ…λ‹λ‹¤.

```bash
# λΌμ°ν„°μ—μ„ DHCP μμ•½ μ„¤μ • ν›„
curl http://10.10.10.100/api/status  # ν•­μƒ κ°™μ€ IP
```

### π”¬ κΈ°μ μ  μ΄μ 

ESP32μ mDNS κµ¬ν„(`ESPmDNS` λΌμ΄λΈλ¬λ¦¬)μ€:
- WiFi μΈν„°νμ΄μ¤(`esp_netif_t`)μ— μ§μ ‘ λ°”μΈλ”©λ¨
- Ethernet μΈν„°νμ΄μ¤λ¥Ό mDNS λ μ΅Έλ²„μ— λ“±λ΅ν•μ§€ μ•μ
- lwIPμ mDNS λ μ΄μ–΄κ°€ WiFi μΈν„°νμ΄μ¤λ§ μ²λ¦¬ν•λ„λ΅ κµ¬ν„λ¨

**κ²°λ΅ **: νμ›¨μ–΄ λ λ²¨μ—μ„μ κ·Όλ³Έμ μΈ μ ν•μ‚¬ν•­μ…λ‹λ‹¤.

# ethernet_mDNS
